<div class="tasks-container">
  <div class="tasks-header">
    <h2>ğŸ“‹ GestiÃ³n de Tareas</h2>
    <button class="btn-create" (click)="showAddTaskForm = !showAddTaskForm">
      {{ showAddTaskForm ? 'âŒ Cancelar' : 'â• Nueva Tarea' }}
    </button>
  </div>

  <!-- Formulario para crear/editar tareas -->
  <div class="task-form" *ngIf="showAddTaskForm">
    <h3>{{ editingTask ? 'âœï¸ Editar Tarea' : 'â• Crear Nueva Tarea' }}</h3>

    <div class="form-grid">
      <div class="form-group">
        <label for="task-name">ğŸ“ Nombre de la tarea:</label>
        <input
          id="task-name"
          type="text"
          [(ngModel)]="newTask.name"
          placeholder="Ej: Lavar los platos"
          required>
      </div>

      <div class="form-group">
        <label for="task-points">ğŸ¯ Puntos:</label>
        <input
          id="task-points"
          type="number"
          [(ngModel)]="newTask.points"
          placeholder="10"
          min="1"
          max="100"
          required>
      </div>

      <div class="form-group">
        <label for="task-category">ğŸ“‚ CategorÃ­a:</label>
        <select id="task-category" [(ngModel)]="newTask.category" required>
          <option value="">Seleccionar categorÃ­a</option>
          <option *ngFor="let category of categories; trackBy: trackByCategory" [value]="category.key">
            {{ category.value }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="task-icon">ğŸ˜Š Emoji:</label>
        <div class="emoji-selector">
          <input
            id="task-icon"
            type="text"
            [(ngModel)]="newTask.icon"
            placeholder="ğŸ“"
            maxlength="2">
          <div class="emoji-options">
            <button
              type="button"
              *ngFor="let emoji of getEmojiSuggestions()"
              class="emoji-option"
              (click)="selectEmoji(emoji)">
              {{ emoji }}
            </button>
          </div>
        </div>
      </div>

      <div class="form-group full-width">
        <label for="task-description">ğŸ“„ DescripciÃ³n:</label>
        <textarea
          id="task-description"
          [(ngModel)]="newTask.description"
          placeholder="DescripciÃ³n de la tarea (opcional)"
          rows="3"></textarea>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-cancel" (click)="cancelAddTask()">
        Cancelar
      </button>
      <button
        type="button"
        class="btn-save"
        (click)="editingTask ? updateTask() : addTask()"
        [disabled]="!isValidTask() || isCreatingTask">
        <span *ngIf="isCreatingTask">ğŸ”„ {{ editingTask ? 'Actualizando...' : 'Creando...' }}</span>
        <span *ngIf="!isCreatingTask">ğŸ’¾ {{ editingTask ? 'Actualizar' : 'Crear' }} Tarea</span>
      </button>
    </div>
  </div>

  <!-- Lista de tareas -->
  <div class="tasks-list">
    <div
      *ngFor="let task of tasks; trackBy: trackByTaskId"
      class="task-card"
      [class]="task.category">

      <div class="task-header">
        <div class="task-info">
          <h4>{{ task.icon }} {{ task.name }}</h4>
          <div class="task-meta">
            <span class="meta-item">ğŸ¯ {{ task.points }} puntos</span>
            <span class="meta-item">ğŸ“‚ {{ getCategoryName(task.category) }}</span>
            <span class="meta-item" *ngIf="task.is_default">ğŸ”§ Por defecto</span>
          </div>
          <p class="task-description" *ngIf="task.description">{{ task.description }}</p>
        </div>

        <div class="task-actions">
          <button class="btn-complete" (click)="showCompleteDialog(task)" title="Completar tarea">
            âœ… Completar
          </button>
          <button class="btn-edit" (click)="editTask(task)" title="Editar tarea">
            âœï¸
          </button>
          <button class="btn-delete" (click)="deleteTask(task.id)" title="Eliminar tarea">
            ğŸ—‘ï¸
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado vacÃ­o -->
  <div class="no-tasks" *ngIf="tasks.length === 0">
    <div class="no-tasks-icon">ğŸ“</div>
    <h3>No hay tareas disponibles</h3>
    <p>Â¡Crea tu primera tarea para empezar!</p>
  </div>

  <!-- Modal para completar tarea -->
  <div class="modal-overlay" *ngIf="showCompleteModal" (click)="closeCompleteDialog()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>âœ… Completar Tarea</h3>
        <button class="btn-close" (click)="closeCompleteDialog()">âŒ</button>
      </div>

      <div class="modal-body" *ngIf="selectedTask">
        <div class="task-summary">
          <h4>{{ selectedTask.icon }} {{ selectedTask.name }}</h4>
          <p class="task-points">ğŸ¯ {{ selectedTask.points }} puntos</p>
          <p class="task-description" *ngIf="selectedTask.description">{{ selectedTask.description }}</p>
        </div>

        <div class="member-selection">
          <label for="member-select">ğŸ‘¤ Â¿QuiÃ©n completÃ³ esta tarea?</label>
          <select id="member-select" [(ngModel)]="selectedMemberId" required>
            <option value="">Seleccionar miembro</option>
            <option *ngFor="let member of members$ | async; trackBy: trackByMemberId" [value]="member.id">
              {{ member.avatar }} {{ member.name }}
            </option>
          </select>
        </div>

        <div class="completion-notes">
          <label for="completion-notes">ğŸ’¬ Notas (opcional):</label>
          <textarea
            id="completion-notes"
            [(ngModel)]="completionNotes"
            placeholder="Agrega notas sobre cÃ³mo se completÃ³ la tarea..."
            rows="3"></textarea>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-cancel" (click)="closeCompleteDialog()">
          Cancelar
        </button>
        <button
          type="button"
          class="btn-confirm"
          (click)="confirmCompleteTask()"
          [disabled]="!selectedMemberId || isCompletingTask">
          <span *ngIf="isCompletingTask">ğŸ”„ Registrando...</span>
          <span *ngIf="!isCompletingTask">âœ… Registrar Completado</span>
        </button>
      </div>
    </div>
  </div>
</div>
